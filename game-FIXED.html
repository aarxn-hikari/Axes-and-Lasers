<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<meta name="description" content="AXES &amp; LASERS — Resaca Cósmica is a retro‑inspired roguelike shooter with neon aesthetics and intense gameplay."/>
<meta property="og:title" content="AXES &amp; LASERS — Resaca Cósmica"/>
<meta property="og:description" content="Enter a cosmic dungeon crawler inspired by classic arcade games.  Survive waves of enemies and upgrade your hero."/>
<meta property="og:type" content="website"/>
<meta property="og:image" content=""/>
<meta name="theme-color" content="#030307"/>
<title>AXES &amp; LASERS — Resaca Cósmica</title>

<!-- External dependencies -->
<link href="https://unpkg.com/nes.css@2.3.0/css/nes.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<!-- Anime.js for UI animations -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>

<!-- Root variables and base styles -->
<style>
/*
 * AXES & LASERS — Resaca Cósmica
 * FIXED VERSION - QA Audit Complete
 */

/* ================================
   0) ROOT THEME */
:root{
  --bg: #030307;
  --bg-panel: #101018;
  --bg-modal: #08080f;
  --accent: #00f2ff;
  --accent-dim: #008cff;
  --danger: #ff2a6d;
  --gold: #ffb300;
  --green: #00ff88;
  --rare: #009dff;
  --epic: #9d00ff;
  --legendary: #ff6a00;
  --text: #e0e6f0;
  --text-dim: #8fa1c4;
  --shadow: rgba(0,0,0,.85);
  --glow: rgba(0,242,255,.45);
  --scanline: linear-gradient(rgba(255,255,255,.04), rgba(0,0,0,0) 2px);
  --font-arcade: 'Press Start 2P', ui-monospace, Menlo, Consolas, "Courier New", monospace;
  --font-ui: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  --bg-glass: rgba(10,12,20,0.7);
  --radius: 18px;
  --ink: #e6f2ff;
  --ink-dim: #9bb3cc;
  --accent-2: #7a5cff;
  --accent-3: #00ffa2;
  --grid: rgba(120,150,220,0.08);
  --shadow-strong: 0 10px 30px rgba(0,0,0,0.5);
}

*{ box-sizing:border-box; margin:0; padding:0; user-select:none; -webkit-tap-highlight-color:transparent }
html,body{ height:100%; width:100%; overflow:hidden; }
body{
  background:
    radial-gradient(1200px 800px at 70% 20%, rgba(0,255,200,0.08), transparent 50%),
    radial-gradient(900px 600px at 20% 80%, rgba(120,90,255,0.10), transparent 60%),
    linear-gradient(180deg, #070912, #03040a 55%, #020309);
  color: var(--ink);
  font-family: var(--font-ui);
  font-size:14px;
  line-height:1.6;
  position: relative;
}

/* CRT scanlines and vignette */
body::before, body::after {
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 9999;
}
body::before {
  background: linear-gradient(rgba(255,255,255,0.03) 50%, rgba(0,0,0,0.03) 50%);
  background-size: 100% 2px;
  mix-blend-mode: overlay;
  opacity: .15;
}
body::after {
  box-shadow: inset 0 0 250px rgba(0,0,0,0.75), inset 0 0 120px rgba(0,0,0,0.55);
}

/* Utility classes */
.hidden { display: none !important; }
.centered { display: grid; place-items: center; }
.glass {
  background: var(--bg-glass);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: var(--radius);
  box-shadow: var(--shadow-strong);
}
.grid-bg {
  background-image:
    linear-gradient(0deg, var(--grid) 1px, transparent 1px),
    linear-gradient(90deg, var(--grid) 1px, transparent 1px);
  background-size: 40px 40px;
}
.title-font { font-family: var(--font-arcade); letter-spacing: 2px; }
.accent { color: var(--accent); }

#main-menu-overlay .main-menu-container,
#pause-overlay .main-menu-container,
#levelup-overlay .main-menu-container {
  border-radius: var(--radius);
  background: var(--bg-glass);
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: var(--shadow-strong);
  backdrop-filter: blur(12px) saturate(1.1);
}

/* =====================================================
   PANEL SYSTEM (Floating titles) */
.panel {
  background: var(--bg-glass);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: var(--radius);
  box-shadow: var(--shadow-strong);
  backdrop-filter: blur(12px) saturate(1.1);
  padding: 24px;
  position: relative;
}
.panel-title {
  font-family: var(--font-arcade);
  color: var(--accent);
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 1px;
  position: absolute;
  top: -10px;
  left: 20px;
  background: var(--bg-panel);
  padding: 4px 12px;
  border-radius: 6px;
  border: 1px solid rgba(255,255,255,0.08);
  z-index: 1;
  text-shadow: 0 0 5px rgba(0,242,255,.4);
}

#sidebar .panel,
#game-ui-overlay .panel {
  background: var(--bg-glass);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: var(--radius);
  box-shadow: var(--shadow-strong);
  backdrop-filter: blur(12px) saturate(1.1);
}

#event-log .log-entry {
  color: var(--ink);
}

/* ================================
   1) CORE OVERLAY SYSTEM */
#app{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:1000;
}
.screen-overlay{
  position:absolute;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  pointer-events:all;
  background:rgba(0,0,0,.95);
  backdrop-filter: blur(5px);
  background-image: linear-gradient(rgba(0,0,0,.5) 1px, transparent 1px);
  background-size:100% 4px;
  animation:noise .5s infinite step-end;
  z-index:100;
}
.screen-overlay.active{
  display:flex;
}
@keyframes noise{0%,100%{background-position:0 0;}50%{background-position:0 2px;}}

/* =====================================================
   BUTTON SYSTEM (QA Polished) */
.btn {
  font-family: var(--font-arcade);
  font-size: 14px;
  padding: 14px 20px;
  border: 1px solid rgba(255,255,255,0.2);
  background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  color: var(--ink);
  border-radius: var(--radius);
  cursor: pointer;
  text-transform: uppercase;
  transition: all .15s ease;
  display: inline-block;
  text-decoration: none;
  text-align: center;
  width: 100%;
  box-sizing: border-box;
  margin: 5px 0;
}
.btn.focusable:focus, .btn:hover {
  outline: none;
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}
.btn-primary {
  border-color: var(--accent);
  color: var(--accent);
  background: rgba(0,224,255,0.05);
}
.btn-primary:hover, .btn-primary.focusable:focus {
  background: var(--accent);
  color: var(--bg-panel);
  box-shadow: 0 0 24px rgba(0,224,255,0.6);
}

.btn-success {
  border-color: var(--accent-3);
  color: var(--accent-3);
  background: rgba(0,255,162,0.05);
}
.btn-success:hover, .btn-success.focusable:focus {
  background: var(--accent-3);
  color: var(--bg-panel);
  box-shadow: 0 0 24px rgba(0,255,162,0.6);
}

.btn-warning {
  border-color: var(--gold);
  color: var(--gold);
  background: rgba(255,200,87,0.05);
}
.btn-warning:hover, .btn-warning.focusable:focus {
  background: var(--gold);
  color: var(--bg-panel);
  box-shadow: 0 0 24px rgba(255,200,87,0.6);
}

.btn-error, .btn-danger {
  border-color: var(--danger);
  color: var(--danger);
  background: rgba(255,42,109,0.05);
}
.btn-error:hover, .btn-error.focusable:focus,
.btn-danger:hover, .btn-danger.focusable:focus {
  background: var(--danger);
  color: var(--bg-panel);
  box-shadow: 0 0 24px rgba(255,42,109,0.6);
}

.focusable:focus {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
  border-radius: var(--radius);
}

.menu-item {
  text-align: left;
  letter-spacing: 1px;
  display: block;
  width: 100%;
}

/* =====================================================
   FORM CONTROLS */
.switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 26px;
}
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
.switch i {
  position: absolute;
  cursor: pointer;
  inset: 0;
  background-color: rgba(255,255,255,0.1);
  border-radius: 20px;
  border: 1px solid rgba(255,255,255,0.2);
  transition: .3s;
}
.switch i::before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 3px;
  bottom: 3px;
  background-color: var(--ink-dim);
  border-radius: 50%;
  transition: .3s;
}
.switch input:checked + i {
  background-color: var(--accent);
}
.switch input:checked + i::before {
  transform: translateX(24px);
  background-color: white;
}

.range {
  -webkit-appearance: none;
  width: 220px;
  height: 8px;
  background: rgba(255,255,255,0.1);
  border-radius: 5px;
  border: 1px solid rgba(255,255,255,0.2);
  outline: none;
}
.range::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 20px;
  height: 20px;
  background: var(--ink);
  border-radius: 50%;
  border: 2px solid var(--bg-panel);
  cursor: pointer;
  transition: background .2s;
}
.range::-webkit-slider-thumb:hover {
  background: var(--accent);
}
.range::-moz-range-thumb {
  width: 20px;
  height: 20px;
  background: var(--ink);
  border-radius: 50%;
  border: 2px solid var(--bg-panel);
  cursor: pointer;
  transition: background .2s;
}
.range::-moz-range-thumb:hover {
  background: var(--accent);
}

#pause-overlay.screen-overlay {
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(6px);
}

/* ==================================
   2) BOOT SCREEN (PS1/PS2-style) */
#boot-sequence-overlay{
  background: #000;
  color: var(--accent);
  justify-content: center;
  align-items: center;
  padding: 40px;
  flex-direction: column;
  gap: 24px;
}

.boot-logo {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  opacity: 0;
}

.boot-sigil {
  width: 160px;
  height: 160px;
  border-radius: 50%;
  background: radial-gradient(circle at 60% 40%, var(--accent), transparent 55%),
              radial-gradient(circle at 40% 60%, var(--accent-2), transparent 55%),
              radial-gradient(circle at 50% 50%, rgba(255,255,255,0.08), transparent 60%);
  filter: drop-shadow(0 0 12px rgba(0,224,255,0.6));
  opacity: 0;
}

.boot-text {
  font-size: 18px;
  text-transform: uppercase;
  letter-spacing: 8px;
  color: var(--ink);
  opacity: 0;
}

.boot-sub {
  color: var(--ink-dim);
  font-size: 12px;
  letter-spacing: 4px;
  opacity: 0;
}

.bios-text{
  width: min(720px, 90vw);
  max-height: min(300px, 40vh);
  overflow: hidden;
  padding: 20px;
  background: var(--bg-glass);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(0,255,255,0.3);
  border-radius: var(--radius);
  box-shadow: 0 0 30px rgba(0,255,255,0.2);
  font-family: var(--font-arcade);
  font-size: 10px;
  line-height: 1.6;
  opacity: 0;
}

.bios-line {
  opacity: 0;
  margin-bottom: 6px;
  color: var(--accent);
}

#boot-continue {
  opacity: 0;
  margin-top: 10px;
}

/* ==================================
   3) TITLE / STUDIO SPLASH */
#title-screen-overlay{ background:var(--bg); flex-direction:column; gap:24px; }
.title-card-container{ display:flex; flex-direction:column; align-items:center; text-align:center; padding:40px; }
.studio-logo{
  font-family:var(--font-arcade);
  font-size:50px;
  color:#fff;
  letter-spacing:6px;
  text-shadow:0 0 40px var(--glow), 0 8px 30px var(--shadow);
  animation:pulse-glow 2s infinite alternate;
}
@keyframes pulse-glow{ from{ text-shadow:0 0 20px var(--glow);} to{ text-shadow:0 0 60px var(--glow), 0 0 10px var(--accent);} }
.studio-tagline{ font-family:var(--font-arcade); color:var(--text-dim); margin-top:6px; opacity:0; }
.studio-sfx{ font-family:var(--font-arcade); color:#fff; margin:22px 0; opacity:0; }

/* ==================================
   4) MAIN MENU */
#main-menu-overlay{ background: radial-gradient(1100px 600px at 70% 10%, rgba(0,242,255,.08), transparent 60%), rgba(0,0,0,.92); }
.main-menu-container{
  width:min(1000px, 90vw);
  height:min(640px, 86vh);
  background:var(--bg-modal);
  border:4px solid var(--accent);
  border-radius:12px;
  padding:36px;
  box-shadow:0 0 50px var(--glow), inset 0 0 20px rgba(0,242,255,.15);
  display:flex;
  flex-direction:column;
  transform:scale(.95);
  opacity:0;
  transition:.45s;
}
.main-menu-container.active{ transform:scale(1); opacity:1; }
.menu-header{ font-family:var(--font-arcade); font-size:28px; color:var(--accent); text-align:center; text-shadow:0 0 15px var(--glow); margin-bottom:22px; }
.menu-content{ display:flex; gap:22px; flex:1; min-height:0; }

.menu-nav{ width:220px; border-right:2px solid var(--accent-dim); padding-right:16px; }
.menu-nav button{
  display:block; width:100%; text-align:left;
  background:none; color:var(--text-dim);
  border:none;
  padding:10px 0;
  font-family:var(--font-arcade);
  font-size:12px;
  cursor:pointer;
  position:relative;
  overflow:hidden;
}
.menu-nav button::before{ content:""; position:absolute; left:-100%; inset:0 0 0 0; background:linear-gradient(90deg, transparent, rgba(0,242,255,.2), transparent); transition:left .5s; }
.menu-nav button:hover::before{ left:100%; }
.menu-nav button:hover{ color:var(--accent); text-shadow:0 0 8px var(--glow); }
.menu-nav button.active{ color:var(--accent); font-size:13px; border-left:3px solid var(--accent); padding-left:10px; }

.menu-panel{ flex:1; overflow:auto; padding-left:22px; opacity:0; transform:translateX(16px); transition:.3s; }
.menu-panel.active{ opacity:1; transform:translateX(0); }
.menu-panel h3{ color:var(--gold); font-size:16px; margin-bottom:12px; font-family:var(--font-arcade); }

.setting-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 0;
  border-bottom:1px solid rgba(255,255,255,0.08);
  font-size:13px;
  margin-bottom:8px;
}
.setting-item:last-child {
  border-bottom: none;
}
.setting-item span{
  color:var(--ink);
  font-weight: 500;
}
.setting-item .range {
  width: 180px;
}
.slider-container{
  display:flex;
  align-items:center;
  gap:12px;
}

/* ==================================
   5) IN-GAME HUD - CRITICAL FIX */
#game-ui-overlay{
  position:fixed !important;
  top:0 !important;
  left:0 !important;
  width:100vw !important;
  height:100vh !important;
  display:none;
  pointer-events:none;
  z-index:50;
  align-items:flex-start !important;
  justify-content:flex-start !important;
}
#game-ui-overlay.screen-overlay{
  background: none !important;
  backdrop-filter: none !important;
  animation: none !important;
  pointer-events: none !important;
}
#game-ui-overlay.active {
  display: block !important;
}
#game-container{
  position:absolute;
  top:0;
  left:0;
  width:100vw;
  height:100vh;
  pointer-events:none;
  display:block;
}
#canvas-area{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  pointer-events:all;
}

/* CRITICAL FIX: Canvas container positioning */
#canvas-container {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  z-index: 1 !important;
  background: #0c1119;
}

#game-canvas, #hud-canvas {
  image-rendering: pixelated;
  image-rendering: -moz-crisp-edges;
  image-rendering: crisp-edges;
}

/* CRITICAL FIX: Game canvas absolute positioning with explicit dimensions */
#game-canvas {
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  z-index: 1;
  background:#1a1a1a;
  box-shadow:0 0 30px rgba(0,0,0,.5);
  display:block;
  opacity:1;
  pointer-events:auto;
}

#hud-canvas {
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  z-index: 2;
  pointer-events: none;
}

/* Minimap */
#minimap-container{
  position:absolute;
  bottom:14px;
  left:14px;
  width:200px;
  height:200px;
  z-index:10;
  pointer-events:none;
}

#minimap-container canvas{
  width:100%;
  height:calc(100% - 0px);
  border-radius: 12px;
  background:#0a0c12;
  border: 1px solid rgba(0, 242, 255, 0.3);
  margin-top: 8px;
}

/* Auto-aim indicator */
#auto-aim-indicator{
  position:absolute;
  top:14px;
  right:348px;
  width: 140px;
  text-align: center;
  z-index:10;
  pointer-events:all;
  cursor:pointer;
  transition:.2s;
}

#auto-aim-indicator #auto-aim-status {
  font-size: 14px;
  font-weight: 700;
  color: var(--accent);
  display: block;
  margin-top: 4px;
}

#auto-aim-indicator:hover{
  transform:scale(1.02);
}
#auto-aim-indicator.off #auto-aim-status{
  color:var(--danger);
}

/* Room info display */
#room-display{
  position:absolute;
  bottom:230px;
  left:14px;
  width:200px;
  z-index:10;
  pointer-events:none;
  text-align:left;
  font-size:11px;
}

#room-display .room-number{
  font-weight:600;
  color:var(--gold);
  margin-bottom:4px;
  margin-top: 4px;
}

#room-display .enemy-count{
  color:var(--accent);
  font-weight: 500;
}

/* Sidebar panels */
#sidebar{
  position:fixed;
  top:14px;
  right:14px;
  width:320px;
  max-height:calc(100vh - 28px);
  display:flex;
  flex-direction:column;
  gap:12px;
  overflow:auto;
  padding-bottom:20px;
  pointer-events:auto !important;
  z-index:60;
}
.panel{
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  border:1px solid rgba(255,255,255,.20);
  border-radius:14px;
  padding:14px;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.15),
    0 8px 30px rgba(0,0,0,.35);
  backdrop-filter: blur(10px) saturate(1.2);
}

#sidebar .panel.stats { display: none; }
body.show-stats #sidebar .panel.stats { display: block; }
.panel-title{
  font-family:var(--font-arcade);
  font-size:12px;
  color:var(--accent);
  margin-bottom:10px;
  letter-spacing:2px;
  text-transform:uppercase;
  text-shadow:0 0 5px rgba(0,242,255,.4);
}

/* Bars */
.stat-bar{
  margin-bottom:12px;
}
.stat-label{
  font-size:11px;
  color:var(--ink);
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
  font-weight: 600;
}
.bar-container{
  height:16px;
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.18);
  border-radius:10px;
  overflow:hidden;
  position:relative;
}
.bar-fill{
  height:100%;
  transition:width .3s ease;
  position:relative;
  overflow:hidden;
  box-shadow: 0 0 12px currentColor;
}
.bar-fill::after{
  content:"";
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  background:linear-gradient(90deg, transparent, rgba(255,255,255,.3), transparent);
  animation:shimmer 2s infinite;
}
@keyframes shimmer{ to{ left:100%; } }
#hp-bar{
  background:linear-gradient(90deg, var(--danger), #ff7b9e);
}
#energy-bar{
  background:linear-gradient(90deg, var(--accent-3), #24ffd1);
}
#xp-bar{
  background:linear-gradient(90deg, #6aa2ff, #a8c2ff);
}

/* Stats grid */
.stats-grid{ display:grid; grid-template-columns:repeat(2,1fr); gap:8px; margin-top:6px; }
.stat-item{ background:rgba(0,242,255,.1); padding:8px; border-radius:6px; border:1px solid rgba(0,242,255,.3); text-align:center; }
.stat-name{ font-size:9px; color:var(--text-dim); margin-bottom:2px; }
.stat-value{ font-size:18px; color:var(--accent); font-weight:800; }

/* Inventory */
#inventory-grid{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:6px;
  max-height:250px;
  overflow:auto;
}
.item-slot{
  aspect-ratio:1;
  background:rgba(0,0,0,.45);
  border:2px solid;
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  cursor:pointer;
  transition:.2s;
}
.item-slot:hover{ transform:scale(1.08); box-shadow:0 0 15px currentColor; }
.item-slot span{ font-size:22px; }
.item-count{ position:absolute; right:6px; bottom:6px; background:rgba(0,0,0,.85); padding:2px 6px; border-radius:6px; font-size:10px; color:var(--text); }
.rarity-common{ border-color:#6a6a6a; }
.rarity-rare{ border-color:var(--rare); }
.rarity-epic{ border-color:var(--epic); }
.rarity-legendary{ border-color:var(--legendary); animation:pulse 2s infinite; }
@keyframes pulse{ 50%{ box-shadow:0 0 22px var(--legendary); } }

/* Event log */
#event-log{ max-height:200px; overflow:auto; font-size:10px; line-height:1.4; }
.log-entry{ padding:4px 8px; margin-bottom:2px; border-radius:4px; border-left:3px solid; background:rgba(0,0,0,.3); }
.log-info{ border-color:var(--accent); color:var(--accent); }
.log-success{ border-color:var(--green); color:var(--green); }
.log-error{ border-color:var(--danger); color:var(--danger); }
.log-warn{ border-color:var(--gold); color:var(--gold); }


/* ==================================
   6) PAUSE & LEVEL UP */
#pause-overlay .menu-header{ font-size:32px; text-shadow:0 0 20px var(--glow); margin-bottom:26px; }
.perk-cards{ display:grid; grid-template-columns:repeat(3,1fr); gap:20px; margin-top:12px; }
.perk-card{
  background:rgba(0,242,255,.1);
  border:2px solid var(--accent);
  border-radius:8px;
  padding:16px;
  cursor:pointer;
  transition:.25s;
}
.perk-card:hover{ transform:translateY(-8px); box-shadow:0 10px 30px var(--glow); border-color:#fff; }
.perk-card h3{ font-size:12px; color:var(--accent); margin-bottom:8px; font-family:var(--font-arcade); }
.perk-card p{ font-size:11px; color:var(--text); }
.perk-card.rare{ border-color:var(--rare); background:rgba(0,157,255,.1); }
.perk-card.epic{ border-color:var(--epic); background:rgba(157,0,255,.1); }
.perk-card.legendary{ border-color:var(--legendary); background:rgba(255,106,0,.1); animation:pulse 2s infinite; }

/* ==================================
   7) RESPONSIVE */
@media (max-width:1400px){
  #sidebar{ width:280px; }
}
@media (max-width:1024px){
  #sidebar, #controls-hint{ display:none; }
  .main-menu-container{ width:95%; height:95%; }
  .menu-content{ flex-direction:column; }
  .menu-nav{ width:100%; border-right:none; border-bottom:2px solid var(--accent-dim); padding-right:0; padding-bottom:14px; margin-bottom:14px; display:flex; flex-wrap:wrap; gap:10px; }
  .menu-nav button{ width:auto; flex:1; min-width:140px; text-align:center; }
  .menu-nav button.active{ border-left:none; border-bottom:3px solid var(--accent); padding-left:0; padding-bottom:6px; }
  .menu-panel{ padding-left:0; }
}
@media (max-width:768px){ .perk-cards{ grid-template-columns:1fr; } .studio-logo{ font-size:34px; } .menu-header{ font-size:22px; } }
:focus-visible{ outline:3px solid var(--gold); outline-offset:2px; border-radius:6px; }
</style>

<!-- Z-INDEX HIERARCHY documentation -->
<style>
/* =====================================
   Z-INDEX HIERARCHY (documented)
   ===================================== */
/* Layer 0: Body background gradients are implicit */
/* Layer 1: Canvas gameplay */
#game-canvas { z-index:1; }

/* Layer 10: HUD elements above the canvas */
#minimap-container,
#auto-aim-indicator,
#room-display,
#sidebar { z-index:10; }

/* Layer 100: Modal overlays (e.g. pause menus) */
.screen-overlay { z-index:100; }

/* Layer 1000: System UI container */
#app { z-index:1000; }

/* Ensure HUD elements receive input even when overlay is transparent */
#sidebar,
#minimap-container,
#auto-aim-indicator,
#room-display {
  position:absolute;
  pointer-events:auto;
}
</style>
</head>
<body class="grid-bg">

<!-- Canvas Layer Structure: Game (background) + HUD (overlay) -->
<!-- CRITICAL FIX: Removed inline styles, relying on CSS for positioning -->
<div id="canvas-container">
  <canvas id="game-canvas"
          role="application"
          aria-label="Axes &amp; Lasers gameplay canvas"
          tabindex="0">
    <p>Your browser does not support the HTML5 canvas element required to play this game.</p>
    <p>Please upgrade to a modern browser.</p>
  </canvas>

  <canvas id="hud-canvas"
          aria-label="HUD overlay">
  </canvas>
</div>

<!-- App container -->
<div id="app">

  <!-- Boot (BIOS) screen -->
  <div id="boot-sequence-overlay" class="screen-overlay screen-boot active">
    <div class="boot-logo">
      <div class="boot-sigil" id="bootSigil"></div>
      <div class="boot-text title-font">HIKARI CREATIVE STUDIOS</div>
      <div class="boot-sub">legacy systems initializing…</div>
    </div>
    <div class="bios-text" id="bios-text"></div>
    <button class="btn focusable" id="boot-continue" tabindex="0">Press Start</button>
  </div>

  <!-- Title / Studio splash -->
  <div id="title-screen-overlay" class="screen-overlay screen-title centered">
    <div class="title-card-container glass">
      <div class="studio-logo title-font">HIKARI CREATIVE STUDIOS</div>
      <div class="studio-tagline accent" id="studio-tagline">// Arquitectura orientada a eventos //</div>
      <div class="studio-sfx accent" id="studio-sfx">It's in the flame.</div>
      <button class="btn focusable" id="title-continue" tabindex="0">Continuar</button>
    </div>
  </div>

  <!-- Main Menu -->
  <div id="main-menu-overlay" class="screen-overlay screen-main centered">
    <div class="main-menu-container" id="main-menu-container">
      <h2 class="menu-header">AXES &amp; LASERS</h2>
      <p class="subtitle" style="color:var(--ink-dim); font-size:12px; margin-bottom:12px;">un rogue‑lite sobre un enano medieval borracho contra robots cyberpunk del futuro</p>
      <div class="menu-content">
        <nav class="menu-nav">
          <button class="focusable active" data-target="new-game-panel" tabindex="0">Nueva Partida</button>
          <button class="focusable" data-target="settings-panel" tabindex="0">Ajustes</button>
          <button class="focusable" data-target="guide-panel" tabindex="0">Guía / Lore</button>
          <button class="btn-danger focusable" id="menu-exit" tabindex="0">Salir</button>
        </nav>

        <div id="menu-panels" class="menu-panel active">
          <!-- New Game -->
          <div id="new-game-panel" class="tab-content active">
            <h3>Iniciar nueva partida</h3>
            <p style="font-size:11px; color:var(--gold); margin-bottom:14px">
              Carga un MP3 o usa una seed aleatoria. Mapas 60×60, spawns espaciados, Auto-Aim ON.
            </p>
            <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:6px">
              <button class="btn focusable" id="load-mp3-btn" tabindex="0">Cargar MP3</button>
              <input type="file" id="mp3-input" accept="audio/*" style="display:none">
              <button class="btn focusable" id="random-seed-btn" tabindex="0">Seed Aleatoria</button>
            </div>
          </div>

          <!-- Settings -->
          <div id="settings-panel" class="tab-content" style="display:none">
            <h3>Ajustes del sistema</h3>

            <div class="setting-item">
              <span>Música de fondo</span>
              <label class="switch">
                <input type="checkbox" id="music-toggle" checked>
                <i></i>
              </label>
            </div>

            <div class="setting-item">
              <span>Volumen SFX</span>
              <div class="slider-container">
                <input type="range" min="0" max="100" value="85" class="range" id="sfx-volume">
                <span id="sfx-volume-value" style="color:var(--accent); font-weight:600; min-width:45px;">85%</span>
              </div>
            </div>

            <div class="setting-item">
              <span>Auto-Aim inicial</span>
              <label class="switch">
                <input type="checkbox" id="auto-aim-toggle" checked>
                <i></i>
              </label>
            </div>

            <div class="setting-item">
              <span>CRT Scanlines</span>
              <label class="switch">
                <input type="checkbox" id="scanlines-toggle" checked>
                <i></i>
              </label>
            </div>

            <div class="setting-item">
              <span>UI Scale</span>
              <div class="slider-container">
                <input type="range" min="75" max="125" value="100" class="range" id="ui-scale">
                <span id="ui-scale-value" style="color:var(--accent); font-weight:600; min-width:45px;">100%</span>
              </div>
            </div>

            <p style="font-size:10px; color:var(--ink-dim); margin-top:16px; opacity:0.7;">Las configuraciones se guardan automáticamente.</p>
          </div>

          <!-- Guide -->
          <div id="guide-panel" class="tab-content" style="display:none">
            <h3>Guía de supervivencia</h3>
            <p style="font-size:12px">Roguelite twin‑stick con progresión profunda (loot, crafting, perks).</p>
            <ul style="font-size:11px; padding-left:18px; list-style: '— '">
              <li>Might: daño físico.</li>
              <li>Focus: poder de láseres y hechizos.</li>
              <li>Grit: vida máxima y mitigación.</li>
              <li>Haste: velocidad y cooldowns.</li>
              <li>Luck: drops y críticos.</li>
            </ul>
            <div style="margin-top:12px; padding:12px; background:rgba(0,0,0,.3); border-radius:8px">
              <h4 style="color:var(--gold); margin-bottom:8px; font-family:var(--font-arcade)">Controles</h4>
              <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; font-size:11px">
                <div><strong>WASD / L-Stick</strong> Movimiento</div>
                <div><strong>Mouse / R-Stick</strong> Apuntar/Disparar</div>
                <div><strong>Space / A</strong> Dash</div>
                <div><strong>Click / X</strong> Ataque</div>
                <div><strong>E / B</strong> Spell</div>
                <div><strong>Esc</strong> Pausa</div>
              </div>
            </div>
          </div>
        </div> <!-- /menu-panel -->
      </div>
    </div>
  </div>

  <!-- Game HUD -->
  <div id="game-ui-overlay" class="screen-overlay screen-game">
    <div id="game-container">
      <div id="canvas-area">
        <div id="minimap-container" class="panel hud-minimap">
          <h3 class="panel-title">Minimap</h3>
          <canvas id="minimap"></canvas>
        </div>
        <div id="auto-aim-indicator" class="panel" title="Click para alternar auto-aim">
          <h3 class="panel-title">Auto-Aim</h3>
          <span id="auto-aim-status">ON</span>
        </div>
        <div id="room-display" class="panel">
          <h3 class="panel-title">Room Info</h3>
          <div class="room-number"><span id="current-room">Sala 1/1</span></div>
          <div class="enemy-count">Enemigos: <span id="enemies-remaining">0</span></div>
        </div>
      </div>

      <div id="sidebar">
        <div class="panel hud-status">
          <h3 class="panel-title">Status</h3>
          <div class="stat-bar">
            <div class="stat-label"><span>HP</span><span id="hp-text">100/100</span></div>
            <div class="bar-container"><div id="hp-bar" class="bar-fill" style="width:100%"></div></div>
          </div>
          <div class="stat-bar">
            <div class="stat-label"><span>Stamina</span><span id="energy-text">100/100</span></div>
            <div class="bar-container"><div id="energy-bar" class="bar-fill" style="width:100%"></div></div>
          </div>
          <div class="stat-bar">
            <div class="stat-label"><span>XP</span><span id="xp-text">0/100</span></div>
            <div class="bar-container"><div id="xp-bar" class="bar-fill" style="width:0%"></div></div>
          </div>
        </div>

        <div class="panel stats">
          <h3 class="panel-title">Stats</h3>
          <div class="stats-grid">
            <div class="stat-item"><div class="stat-name">Might</div><div id="stat-might" class="stat-value">0</div></div>
            <div class="stat-item"><div class="stat-name">Focus</div><div id="stat-focus" class="stat-value">0</div></div>
            <div class="stat-item"><div class="stat-name">Grit</div><div id="stat-grit" class="stat-value">0</div></div>
            <div class="stat-item"><div class="stat-name">Haste</div><div id="stat-haste" class="stat-value">0</div></div>
            <div class="stat-item"><div class="stat-name">Luck</div><div id="stat-luck" class="stat-value">0</div></div>
            <div class="stat-item"><div class="stat-name">Level</div><div id="stat-level" class="stat-value">1</div></div>
          </div>
        </div>

        <div class="panel hud-inventory">
          <h3 class="panel-title">Inventory</h3>
          <div id="inventory-grid"></div>
        </div>

        <div class="panel">
          <h3 class="panel-title">Log</h3>
          <div id="event-log">
            <div class="log-entry log-success">[00:00] Sistema iniciado</div>
            <div class="log-entry log-info">[00:00] Cargando assets…</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pause menu -->
  <div id="pause-overlay" class="screen-overlay screen-pause">
    <div class="main-menu-container" style="height:auto; max-width:720px">
      <h2 class="menu-header">Pausa</h2>
      <div class="menu-content" style="flex-direction:column; align-items:center; gap:10px">
        <button class="btn focusable" id="resume-btn" tabindex="0">Continuar juego</button>
        <button class="btn focusable" id="settings-from-pause" tabindex="0">Ajustes</button>
        <button class="btn btn-danger focusable" id="exit-to-menu" tabindex="0">Volver al menú</button>
      </div>
    </div>
  </div>

  <!-- Level Up screen -->
  <div id="levelup-overlay" class="screen-overlay screen-levelup">
    <div class="main-menu-container" style="max-width:820px; height:auto; text-align:center">
      <h2 class="menu-header" style="color:var(--gold)">Level Up</h2>
      <p style="margin-bottom:10px">Elige una mejora para tu build</p>
      <div id="perk-cards" class="perk-cards">
        <!-- The perk cards will be dynamically populated by game.js -->
      </div>
    </div>
  </div>

</div> <!-- /app -->

<!-- Game engine -->
<script src="game.js"></script>

<!-- Animate main menu items -->
<script>
  window.addEventListener('load', function(){
    const titleBtn = document.getElementById('title-continue');
    if (!titleBtn) return;
    titleBtn.addEventListener('click', function(){
      const buttons = document.querySelectorAll('#main-menu-overlay .menu-nav button');
      if (!buttons.length) return;
      anime.set(buttons, { translateX: -14, opacity: 0 });
      anime({
        targets: buttons,
        translateX: [ -14, 0 ],
        opacity: [0, 1],
        delay: anime.stagger(110),
        duration: 520,
        easing: 'easeOutQuad'
      });
    });
  });
</script>

<!-- Cleanup on page unload -->
<script>
  window.addEventListener('beforeunload', function(){
    if (window.UIManager && typeof window.UIManager.cleanup === 'function') {
      UIManager.cleanup();
    }
  });
</script>
</body>
</html>
